# 🔴 실시간 데이터 수집 전략 (과거 데이터 포기)

## 💡 핵심 아이디어: "지금부터 모으자!"

### ✅ 장점
```
1. 비용 0원 (무료 API 활용)
2. 과거 데이터 불필요 (FnGuide 22만원 절약!)
3. 3~6개월 모으면 충분한 학습 데이터
4. 실전과 동일한 환경 데이터
5. 최신 시장 패턴 반영
```

### 📅 타임라인
```
Month 1-3: 실시간 데이터 수집 (매일 장 시간)
  → 목표: 500~1,000개 VI 이벤트
  → 비용: 0원

Month 4: AI 학습
  → 수집 데이터로 모델 훈련

Month 5+: 실전 투자
  → 백테스트 검증 후 시작
```

---

## 🎯 무료 실시간 수집 전략

### 1️⃣ 한국투자증권 KIS API (무료, 최고!)

#### 📊 수집 가능 데이터

**✅ 실시간 체결 (틱 단위)**
```python
WebSocket 구독:
  - 종목코드
  - 체결시간 (밀리초 단위)
  - 체결가
  - 체결량
  - 매수/매도 구분
  
업데이트 주기: 실시간 (지연 < 0.1초)
저장 형식: Parquet (압축)
```

**✅ 호가 데이터 (실시간)**
```python
호가 10단계:
  - 매수호가 1~10
  - 매도호가 1~10
  - 매수잔량 1~10
  - 매도잔량 1~10
  
업데이트 주기: 호가 변경 시마다
```

**✅ 체결 강도**
```python
실시간 계산:
  - 매수 체결량
  - 매도 체결량
  - 체결 강도 = 매수/(매수+매도)
```

**⚠️ 제한 사항**
```python
❌ 프로그램 매매 (미제공)
   → 간접 추론 필요

❌ 투자자별 매매 (일봉만)
   → 실시간 불가

❌ VI 발생 사유 (미제공)
   → 자체 감지 알고리즘 필요
```

#### 🔌 API 엔드포인트

**실시간 체결 (WebSocket)**
```python
URL: ws://ops.koreainvestment.com:21000
TR_ID: H0STCNT0  # 실시간 체결가

구독 종목: 최대 40개 동시
재연결: 자동 (토큰 만료 시)
```

**실시간 호가 (WebSocket)**
```python
TR_ID: H0STASP0  # 실시간 호가

데이터:
  - 10단계 호가
  - 호가 잔량
  - 호가 총량
```

**일봉/분봉 조회 (REST)**
```python
TR_ID: FHKST03010100  # 일봉
TR_ID: FHKST03010200  # 주/월봉

과거 데이터: ❌ 분봉 제공 안 함
```

#### 💾 저장 구조
```python
data/
  realtime/
    2025/
      11/
        20/
          # 틱 데이터 (1분 단위로 파일 분할)
          005930_0900_ticks.parquet
          005930_0901_ticks.parquet
          ...
          005930_1530_ticks.parquet
          
          # 호가 스냅샷 (1초 단위)
          005930_0900_orderbook.parquet
          
          # VI 이벤트 (발생 시)
          005930_090523_vi_event.parquet
```

---

### 2️⃣ 네이버 금융 크롤링 (무료, 보조)

#### 📊 수집 가능 데이터

**✅ 프로그램 매매 (일중 누적)**
```python
크롤링 URL:
https://finance.naver.com/item/frgn.naver?code={stock_code}

데이터:
  - 프로그램 순매수 (누적)
  - 기관 순매수 (누적)
  - 외국인 순매수 (누적)
  
업데이트: 10분마다 수동 크롤링
한계: 실시간 아님, 누적값만
```

**✅ 뉴스 (준실시간)**
```python
크롤링 URL:
https://finance.naver.com/item/news_news.naver?code={stock_code}

데이터:
  - 뉴스 제목
  - 발행 시간
  - 뉴스 URL
  - 감성 분석 (자체 구현)

업데이트: 5분마다
```

**✅ 공시 (준실시간)**
```python
크롤링 URL:
https://finance.naver.com/item/news_notice.naver?code={stock_code}

데이터:
  - 공시 제목
  - 공시 시간
  - 공시 종류 (분류)

업데이트: 5분마다
```

#### ⚠️ 주의사항
```
1. 크롤링 속도 제한 (1초 간격)
2. IP 차단 위험 (너무 빠르면)
3. HTML 구조 변경 시 수정 필요
4. 법적 이슈 확인 (robots.txt)
```

---

### 3️⃣ DART 공시 API (무료, 공식)

#### 📊 수집 가능 데이터

**✅ 실시간 공시**
```python
API URL:
https://opendart.fss.or.kr/api/list.json

제공 데이터:
  - 공시 제목
  - 공시 시간 (정확)
  - 공시 종류
  - 공시 내용 (상세)
  
업데이트: 실시간 (공시 발생 즉시)
요청 제한: 10,000건/일
```

**✅ 재무제표**
```python
API:
  - 손익계산서
  - 재무상태표
  - 현금흐름표
  
업데이트: 분기별
```

#### 🔑 API 키 발급
```
1. https://opendart.fss.or.kr 접속
2. 회원가입 (무료)
3. API 키 발급 (즉시)
4. 일일 10,000건 무료
```

---

## 💰 유료 실시간 데이터 서비스

### 1️⃣ QuantiWise Streaming (월 110,000원)

#### 📊 제공 데이터

**✅ 실시간 틱 데이터**
```yaml
WebSocket API:
  - 체결 틱 (밀리초 단위)
  - 호가 10단계 (실시간)
  - 체결 강도
  
업데이트: < 0.05초 지연
동시 구독: 200 종목
```

**✅ 프로그램 매매 (실시간)**
```yaml
제공 항목:
  - 프로그램 순매수 (실시간)
  - 기관 순매수 (실시간)
  - 외국인 순매수 (실시간)
  
업데이트: 10초마다
정확도: 95% (추정값)
```

**✅ 뉴스/공시 연동**
```yaml
뉴스:
  - 실시간 뉴스 피드
  - 감성 분석 (AI)
  - 종목 매칭
  
공시:
  - DART 연동
  - 실시간 알림
  - 중요도 분류
```

**✅ VI 이벤트 감지**
```yaml
자동 감지:
  - VI 발생 시각
  - VI 해제 시각
  - 발동 가격
  
한계:
  - 발동 사유 추정만 (정확하지 않음)
```

#### 💰 가격
```
Standard: 55,000원/월
  - 틱 데이터 (20 종목)
  - 호가 데이터
  
Premium: 110,000원/월 ⭐ 추천
  - 틱 데이터 (200 종목)
  - 프로그램 매매 (실시간)
  - 뉴스/공시 연동
  
Pro: 220,000원/월
  - 무제한 종목
  - API 우선순위
```

---

### 2️⃣ FnGuide Realtime API (월 330,000원)

#### 📊 제공 데이터 (최고 품질)

**✅ 실시간 틱 데이터**
```yaml
정확도: 100% (거래소 직접 연동)
지연: < 0.01초
동시 구독: 무제한
```

**✅ 프로그램 매매 (초단위)**
```yaml
제공:
  - 프로그램 순매수 (1초 단위) ⭐⭐⭐
  - 기관 순매수 (1초 단위)
  - 외국인 순매수 (1초 단위)
  
정확도: 100% (거래소 공식)
```

**✅ VI 이벤트 (완벽)**
```yaml
제공:
  - VI 발생 시각 (밀리초)
  - VI 해제 시각
  - 발동 사유 (정확) ⭐⭐⭐
  - 정적/동적 구분
  - 기준가/발동가
  
실시간 푸시: 즉시
```

**✅ 뉴스/공시 통합**
```yaml
뉴스:
  - 전문 뉴스 피드
  - 감성 분석 (전문가)
  - 종목 영향도 분석
  
공시:
  - DART 실시간 연동
  - 공시 중요도 AI 분류
  - 가격 영향 예측
```

#### 💰 가격
```
Realtime Basic: 220,000원/월
  - 틱 데이터
  - 호가 데이터
  
Realtime Premium: 330,000원/월 ⭐⭐⭐
  - 프로그램 매매 (초단위)
  - VI 이벤트 (완벽)
  - 뉴스/공시 통합
  
Enterprise: 500,000원+/월
  - 맞춤 데이터
  - 전담 지원
```

---

### 3️⃣ 크레온 HTS API (무료, 제한적)

#### 📊 제공 데이터

**✅ 실시간 체결**
```python
대우증권 계좌 필요 (무료)

데이터:
  - 체결 틱
  - 호가 10단계
  - 체결 강도
  
한계:
  - Windows만 지원
  - Python 32bit 필요
  - 크레온 플러스 설치 필수
```

**✅ 투자자별 매매 (일봉)**
```python
제공:
  - 프로그램 매매 (일봉)
  - 기관/외국인 (일봉)
  
실시간: ❌ 불가
```

#### 💰 가격
```
무료 (대우증권 계좌 개설 필요)

단점:
  - 설정 복잡
  - Windows 전용
  - 실시간 프로그램 매매 없음
```

---

## 🎯 최적 실시간 수집 전략

### 🏆 추천 1: 무료 조합 (0원)

```python
# KIS WebSocket (무료)
틱 데이터 + 호가 데이터
  ↓
# 네이버 크롤링 (무료)
프로그램 매매 (10분 단위)
  ↓
# DART API (무료)
공시 실시간
  ↓
# 뉴스 크롤링 (무료)
네이버/다음 뉴스

총 비용: 0원/월
VI 학습 적합도: ⭐⭐⭐☆☆ (70%)
```

#### 장점
```
✅ 완전 무료
✅ 틱 데이터 확보
✅ 3~6개월이면 충분한 데이터
```

#### 단점
```
❌ 프로그램 매매 실시간 아님 (10분 지연)
❌ VI 발동 사유 알 수 없음
❌ 크롤링 안정성 이슈
```

---

### 🏆 추천 2: QuantiWise Premium (110,000원)

```python
# QuantiWise WebSocket API
틱 + 호가 + 프로그램 매매 (실시간)
  ↓
# 뉴스/공시 자동 연동
  ↓
# VI 이벤트 자동 감지

총 비용: 110,000원/월
VI 학습 적합도: ⭐⭐⭐⭐☆ (85%)
```

#### 장점
```
✅ 프로그램 매매 실시간 ⭐
✅ 뉴스/공시 자동 연동
✅ VI 자동 감지
✅ 안정적 API
```

#### 단점
```
❌ 비용 발생 (11만원)
❌ VI 발동 사유 추정만 (정확하지 않음)
```

---

### 🏆 추천 3: FnGuide Realtime (330,000원)

```python
# FnGuide Realtime Premium
틱 + 호가 + 프로그램 (초단위) + VI 완벽
  ↓
# 뉴스/공시 전문가 분석
  ↓
# AI 학습 최적 데이터

총 비용: 330,000원/월
VI 학습 적합도: ⭐⭐⭐⭐⭐ (100%)
```

#### 장점
```
✅ 프로그램 매매 초단위 ⭐⭐⭐
✅ VI 발동 사유 정확 ⭐⭐⭐
✅ 뉴스 영향도 분석
✅ 최고 품질
```

#### 단점
```
❌ 비용 높음 (33만원)
```

---

## 📋 항목별 수집 가능 여부

### 틱 데이터

| 제공처 | 가능 여부 | 지연 시간 | 비용 |
|--------|-----------|-----------|------|
| KIS API | ✅ | 0.1초 | 무료 |
| QuantiWise | ✅ | 0.05초 | 11만원 |
| FnGuide | ✅ | 0.01초 | 33만원 |
| 크레온 | ✅ | 0.2초 | 무료 |

### 호가 데이터 (10단계)

| 제공처 | 가능 여부 | 업데이트 | 비용 |
|--------|-----------|----------|------|
| KIS API | ✅ | 실시간 | 무료 |
| QuantiWise | ✅ | 실시간 | 11만원 |
| FnGuide | ✅ | 실시간 | 33만원 |
| 크레온 | ✅ | 실시간 | 무료 |

### 프로그램 매매

| 제공처 | 실시간 | 주기 | 비용 |
|--------|--------|------|------|
| KIS API | ❌ | 일봉만 | 무료 |
| 네이버 | ⚠️ | 10분 | 무료 |
| QuantiWise | ✅ | 10초 | 11만원 ⭐ |
| FnGuide | ✅ | 1초 | 33만원 ⭐⭐⭐ |
| 크레온 | ❌ | 일봉만 | 무료 |

### VI 이벤트 정보

| 제공처 | 감지 | 발동 사유 | 비용 |
|--------|------|-----------|------|
| KIS API | 🔧 자체 | ❌ | 무료 |
| QuantiWise | ✅ | ⚠️ 추정 | 11만원 |
| FnGuide | ✅ | ✅ 정확 | 33만원 ⭐⭐⭐ |

### 뉴스 연동

| 제공처 | 실시간 | 감성 분석 | 비용 |
|--------|--------|-----------|------|
| 네이버 크롤링 | ⚠️ 5분 | 🔧 자체 | 무료 |
| QuantiWise | ✅ | ✅ AI | 11만원 ⭐ |
| FnGuide | ✅ | ✅ 전문가 | 33만원 ⭐⭐ |
| DART | ❌ | - | 무료 |

### 공시 연동

| 제공처 | 실시간 | 중요도 분류 | 비용 |
|--------|--------|-------------|------|
| DART API | ✅ | 🔧 자체 | 무료 ⭐ |
| QuantiWise | ✅ | ✅ AI | 11만원 |
| FnGuide | ✅ | ✅ AI | 33만원 |

---

## 🚀 3개월 실시간 수집 계획

### Month 1: 인프라 구축 + 수집 시작

**Week 1: 환경 설정**
```bash
# KIS API 준비
1. API 키 발급 완료 (이미 있음!)
2. WebSocket 코드 구현
3. 틱 데이터 저장 구조 설계

# DART API
1. 회원가입
2. API 키 발급
3. 공시 수집 코드 작성
```

**Week 2-4: 본격 수집**
```bash
# 매일 장 시간 (09:00~15:30)
1. KIS WebSocket 실행
2. 네이버 크롤링 (10분마다)
3. DART API 모니터링 (5분마다)

# 목표
- 틱 데이터: 매일 50~100 종목
- VI 이벤트: 10~20개/일
- 뉴스/공시: 모든 종목
```

### Month 2-3: 데이터 축적

**수집 현황**
```
일일 VI 발생: 10~20개
월간 VI 누적: 200~400개
3개월 누적: 600~1,200개 ⭐

→ 학습에 충분한 데이터!
```

**저장 용량**
```
틱 데이터: ~2GB/일
호가 스냅샷: ~500MB/일
VI 이벤트: ~50MB/일

월간 총 용량: ~75GB
3개월: ~225GB (충분히 관리 가능)
```

### Month 4: AI 학습

```python
# 수집된 데이터로 학습
data/realtime/2025/11~2026/01/

학습 데이터: 600~1,200개 VI 이벤트
검증 데이터: 150~300개
테스트 데이터: 150~300개

→ Transformer 모델 훈련
→ 목표 승률: 60~70%
```

---

## 💡 최종 추천 전략

### 🥇 1단계: 무료로 시작 (3개월)

```
비용: 0원
데이터:
  - KIS API (틱 + 호가)
  - 네이버 (프로그램 10분 단위)
  - DART (공시)
  - 뉴스 크롤링

목표: 600~1,200개 VI 이벤트 수집
기간: 3개월
```

### 🥈 2단계: 검증 (Month 4)

```
수집 데이터로 AI 학습
백테스트 승률 확인

IF 승률 < 60%:
  → 6개월 더 수집 (무료)
  
IF 승률 ≥ 60%:
  → 실전 투자 시작!
```

### 🥉 3단계: 업그레이드 (선택)

```
IF 수익 안정:
  → QuantiWise Premium 구독 (11만원)
  → 프로그램 매매 실시간 추가
  → 승률 70~75% 목표

IF 수익 매우 좋음:
  → FnGuide Realtime (33만원)
  → 최고 품질 데이터
  → 승률 80~85% 목표
```

---

## ✅ 실행 계획 (지금 바로!)

### 오늘 할 일
```bash
1. ✅ KIS WebSocket 코드 완성 (이미 작성됨!)
   - /home/user1/auto_trading/crawler/kis_api/kis_realtime_websocket.py

2. 🔧 DART API 키 발급
   - https://opendart.fss.or.kr
   - 회원가입 → API 키 발급

3. 🔧 네이버 크롤링 코드 작성
   - 프로그램 매매 10분마다
```

### 내일 (11/21 목요일)
```bash
# 장 시작 전 (08:50)
cd /home/user1/auto_trading
source learning/trading_bot/bin/activate

# 실시간 수집 시작!
python crawler/kis_api/realtime_collector.py \
  --stocks data/raw/vi_stocks.json \
  --output data/realtime/

# 6.5시간 수집 → 자동 종료
```

### 3개월 후 (2026년 2월)
```bash
# 1,000개 VI 이벤트 수집 완료!
# AI 학습 시작
python ai_model/train.py

# 백테스트
python backtesting/validate.py

# 승률 60%+ → 실전 투자!
```

**핵심: 무료로 3개월 수집 → AI 학습 → 실전!** 🚀
