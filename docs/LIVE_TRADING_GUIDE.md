# 실전 자동매매 시스템 가이드 (30만원 운용)

## 🚀 12/1 실전 매매 준비 가이드

### 1️⃣ 필수 준비 사항

#### A. 한국투자증권 API 인증 정보
```bash
# config/settings.yaml 파일에 입력 필요

kis_api:
  app_key: "YOUR_APP_KEY"        # ← 실제 값으로 변경
  app_secret: "YOUR_APP_SECRET"  # ← 실제 값으로 변경
  account_no: "12345678-01"      # ← 계좌번호-상품코드
  mock_mode: false               # true: 모의투자, false: 실전투자
```

**발급 방법:**
1. 한국투자증권 홈페이지 접속
2. Open API 서비스 신청
3. APP KEY, APP SECRET 발급
4. 계좌번호 확인 (8자리-2자리)

---

#### B. 텔레그램 봇 설정 (선택사항)
```bash
# config/settings.yaml 파일에 추가

telegram:
  bot_token: "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"  # ← 봇 토큰
  chat_id: "987654321"  # ← 채팅방 ID
```

**설정 방법:**
1. 텔레그램에서 `@BotFather` 검색
2. `/newbot` 명령으로 봇 생성
3. 봇 토큰 받기
4. 봇과 대화 시작 (아무 메시지나 전송)
5. `https://api.telegram.org/bot<토큰>/getUpdates` 접속
6. `chat.id` 값 복사

---

### 2️⃣ 자동매매 시스템 구조

```
┌──────────────────────────────────────────┐
│  실전 자동매매 엔진 (30만원 운용)          │
├──────────────────────────────────────────┤
│                                          │
│  1. 급락 감지 (1분마다)                   │
│     ├─ 관심 종목 모니터링                 │
│     ├─ -10% 이상 급락 감지                │
│     └─ AI 예측 확률 체크 (60% 이상)       │
│                                          │
│  2. 매수 실행                             │
│     ├─ 1차 매수: 5만원 (50%)              │
│     ├─ 목표 익절: 종목별 최적화 (8~20%)   │
│     └─ 손절: -5%                         │
│                                          │
│  3. 포지션 관리 (5분마다)                 │
│     ├─ 익절 체크 (목표 달성 시)           │
│     ├─ 손절 체크 (-5%)                   │
│     ├─ 추가 매수 (평균 -3% 추가 하락 시)  │
│     └─ 시간 손절 (5일)                   │
│                                          │
│  4. 자금 관리                             │
│     ├─ 총 자본: 30만원                   │
│     ├─ 종목당 최대: 10만원                │
│     ├─ 최대 동시 보유: 3종목              │
│     └─ 분할 매수: 1차 5만 + 2차 5만       │
│                                          │
│  5. 알림 (텔레그램)                       │
│     ├─ 매수/매도 알림                    │
│     ├─ 익절/손절 알림                    │
│     └─ 일일 리포트                       │
│                                          │
└──────────────────────────────────────────┘
```

---

### 3️⃣ 실행 방법

#### 방법 1: 자동 스케줄러 (권장)
```bash
cd /home/user1/auto_trading
source learning/trading_bot/bin/activate

# 자동매매 시작 (백그라운드)
nohup python auto_trading/live_scheduler.py > logs/live_trading.log 2>&1 &

# 로그 확인
tail -f logs/live_trading.log

# 종료
pkill -f live_scheduler.py
```

**스케줄:**
- 평일 09:00-15:30: 급락 스캔 (1분마다)
- 평일 09:00-15:30: 포지션 관리 (5분마다)
- 평일 15:40: 일일 리포트
- 토요일 01:00: 주간 모델 재학습

---

#### 방법 2: 수동 실행
```bash
cd /home/user1/auto_trading
source learning/trading_bot/bin/activate

# Python 인터프리터
python

# 실행 코드
from auto_trading.live_trading_engine import LiveTradingEngine

engine = LiveTradingEngine()

# 1회 스캔
engine.scan_and_trade()

# 포지션 관리
engine.manage_positions()

# 일일 리포트
engine.generate_daily_report()
```

---

### 4️⃣ 매매 전략 예시

#### 효성(004800) 급락 발생 시나리오

**1단계: 급락 감지**
```
[10:23] 🚨 급락 감지
종목: 효성 (004800)
급락률: -12.3%
현재가: 87,500원
AI 확률: 75.2%
```

**2단계: 1차 매수 (50%)**
```
💰 매수 주문
종목: 효성
가격: 87,500원
수량: 0주 → 계산 (50,000 / 87,500 = 0.57주 → 0주)

※ 주의: 가격이 너무 높으면 수량이 0이 될 수 있음
※ 해결: max_per_trade를 100,000원으로 설정하거나 저가 종목 선택
```

**실제 예시 (저가 종목):**
```
종목: 진양산업 (003780)
현재가: 15,000원
1차 매수: 50,000원 / 15,000원 = 3주
지출: 45,000원
```

**3단계: 추가 하락 시 2차 매수**
```
현재가: 14,000원 (추가 -6.7%)
2차 매수: 50,000원 / 14,000원 = 3주
평균단가: (3*15,000 + 3*14,000) / 6 = 14,500원
총 지출: 87,000원
```

**4단계: 익절 달성**
```
목표 익절: +13.2% (최적화 결과)
목표가: 14,500 * 1.132 = 16,414원
현재가: 16,500원 도달
매도 수량: 6주
수익: 6 * (16,500 - 14,500) = +12,000원
수익률: +13.8%
```

---

### 5️⃣ 실제 30만원 운용 시뮬레이션

#### 시나리오 A: 3종목 동시 보유 (분산 투자)

**종목 1: 진양산업**
- 1차 매수: 45,000원 (3주 @ 15,000원)
- 2차 매수: 42,000원 (3주 @ 14,000원)
- 총 투자: 87,000원

**종목 2: 푸드웰**
- 1차 매수: 50,000원 (10주 @ 5,000원)
- 총 투자: 50,000원 (2차 매수 기회 없이 익절)

**종목 3: 대한항공**
- 1차 매수: 45,000원 (2주 @ 22,500원)
- 2차 매수: 44,000원 (2주 @ 22,000원)
- 총 투자: 89,000원

**총 사용 자금: 226,000원 / 300,000원**
**여유 자금: 74,000원**

---

#### 결과 시뮬레이션 (1주일)

**성공 케이스 (승률 70% 가정):**
```
종목 1: +13.2% → +11,484원
종목 2: +8.6% → +4,300원
종목 3: -5% (손절) → -4,450원

총 수익: +11,334원 (원금 대비 +3.8%)
잔액: 311,334원
```

**최악 케이스 (3종목 모두 손절):**
```
종목 1: -5% → -4,350원
종목 2: -5% → -2,500원
종목 3: -5% → -4,450원

총 손실: -11,300원 (원금 대비 -3.8%)
잔액: 288,700원
```

---

### 6️⃣ 리스크 관리

#### 최대 손실 시나리오
- 일일 최대 3종목 매수 가능
- 모두 손절 시: -5% × 3 = 최대 -15% (45,000원 손실)
- **하지만** 승률 70%이므로 통계적으로 장기적 수익 가능

#### 안전 장치
1. **AI 필터**: 확률 60% 이상만 매수
2. **손절**: -5% 즉시 매도
3. **시간 손절**: 5일 보유 시 강제 청산
4. **최대 포지션**: 3종목까지만 동시 보유

---

### 7️⃣ 모니터링

#### 텔레그램 알림 예시
```
🟢 매수 완료
종목: 진양산업
수량: 3주
금액: 45,000원
AI 확률: 75.2%
목표: +13.2%

🔴 매도 완료 (익절)
종목: 진양산업
손익: +11,484원 (+13.8%)

📊 일일 리포트
거래: 3건
승률: 66.7%
손익: +11,334원
```

---

### 8️⃣ 주의사항

#### 실전 매매 전 체크리스트
- [ ] KIS API 키 발급 및 설정 완료
- [ ] 계좌 잔액 30만원 이상 확보
- [ ] `mock_mode: true`로 모의투자 테스트
- [ ] 텔레그램 봇 설정 (선택)
- [ ] 로그 파일 확인 가능 (`logs/live_trading.log`)
- [ ] 거래 시간 확인 (평일 09:00-15:30)

#### 실전 투자 시 주의
1. **처음 1주일**: 소액(10만원)으로 테스트
2. **손실 누적 시**: 시스템 점검 후 재개
3. **거래량 확인**: 너무 적은 종목은 체결 안 될 수 있음
4. **API 한도**: 1초 20회 제한 (충분히 여유 있음)

---

### 9️⃣ FAQ

**Q1: 30만원으로 충분한가요?**
- A: 3종목 분산 투자 가능 (종목당 10만원)
- 저가 종목(5천원~2만원) 위주로 매매하면 충분

**Q2: 고가 종목(삼성전자 등)은?**
- A: 1주당 7만원이면 1차 매수 시 0주 → 매수 불가
- 해결: 관심 종목을 저가주로 제한

**Q3: 손실이 계속되면?**
- A: 일일 최대 손실 -15% 도달 시 자동 중지 (예정)
- 수동으로 스케줄러 종료 후 점검

**Q4: 모의투자 테스트는?**
- A: `settings.yaml`에서 `mock_mode: true` 설정
- 실제 돈 없이 테스트 가능

**Q5: 수수료는?**
- A: 현재 코드는 미반영
- 실제 수익률은 약 -0.5% 차감 예상

---

### 🎯 12/1 시작 체크리스트

**D-1 (11/30 토요일)**
- [ ] KIS API 키 발급
- [ ] `config/settings.yaml` 설정
- [ ] 모의투자 모드로 테스트 실행
- [ ] 텔레그램 봇 설정 (선택)
- [ ] 계좌 잔액 확인 (30만원 이상)

**D-Day (12/1 일요일... 아니 12/2 월요일)**
※ 12/1은 일요일이므로 실제 시작은 **12/2 월요일**

- [ ] 08:50: 스케줄러 실행
- [ ] 09:00: 거래 시작 로그 확인
- [ ] 15:40: 일일 리포트 확인
- [ ] 16:00: 수익/손실 점검

---

## 📞 문제 발생 시

**에러 로그 확인:**
```bash
tail -100 logs/live_trading.log
```

**긴급 중지:**
```bash
pkill -f live_scheduler.py
```

**수동 포지션 청산:**
```python
from auto_trading.live_trading_engine import LiveTradingEngine
engine = LiveTradingEngine()

# 모든 포지션 확인
print(engine.positions)

# 특정 종목 강제 청산
engine._execute_sell_order('003780', engine.positions['003780'], 15000, "수동 청산")
```

---

**💰 행운을 빕니다! 📈**
