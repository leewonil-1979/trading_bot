"""
í•™ìŠµ ê²°ê³¼ ìƒì„¸ ë¶„ì„ ë° ì‹œê°í™”
"""

import pandas as pd
import numpy as np
import lightgbm as lgb
from pathlib import Path
import json


def analyze_learning_results():
    """í•™ìŠµ ê²°ê³¼ ìƒì„¸ ë¶„ì„"""
    
    print("\n" + "="*80)
    print("ğŸ“Š ê¸‰ë½ í›„ ë°˜ë“± ì˜ˆì¸¡ AI - í•™ìŠµ ê²°ê³¼ ìƒì„¸ ë¶„ì„")
    print("="*80 + "\n")
    
    # =========================================
    # 1. ìˆ˜ì§‘ ë°ì´í„° ë¶„ì„
    # =========================================
    
    print("1ï¸âƒ£ ìˆ˜ì§‘ ë°ì´í„° ë¶„ì„")
    print("-" * 80)
    
    # í†µê³„ ë¡œë“œ
    with open('./data/crash_rebound/collection_stats.json', 'r') as f:
        stats = json.load(f)
    
    print(f"ìˆ˜ì§‘ ê¸°ê°„: {stats['period']}")
    print(f"ìˆ˜ì§‘ ì¢…ëª©: {stats['total_stocks']}ê°œ")
    print(f"ì´ ë°ì´í„°: {stats['total_rows']:,}í–‰ (3ë…„ ì¼ë´‰)")
    print(f"ê¸‰ë½ ì´ë²¤íŠ¸: {stats['total_crashes']}íšŒ")
    print(f"ì„±ê³µ ë°˜ë“±: {stats['successful_rebounds']}íšŒ")
    print(f"ê¸°ë³¸ ì„±ê³µë¥ : {stats['success_rate']:.1f}%")
    print()
    
    # ê¸‰ë½ ê¸°ì¤€ ì„¤ëª…
    print("ğŸ“Œ ê¸‰ë½ ì •ì˜:")
    print("   - í•˜ë£¨ -10% ì´ìƒ í•˜ë½")
    print("   - 3ë…„ê°„ 70ê°œ ì¢…ëª©ì—ì„œ 352íšŒ ë°œìƒ")
    print()
    
    print("ğŸ“Œ ì„±ê³µ ë°˜ë“± ì •ì˜:")
    print("   - ê¸‰ë½ í›„ 5ì¼ ë‚´ +10% ì´ìƒ ìƒìŠ¹")
    print("   - 352íšŒ ì¤‘ 159íšŒ ì„±ê³µ (45.2%)")
    print()
    
    # =========================================
    # 2. ì „ì²´ ë°ì´í„° ë¶„í¬
    # =========================================
    
    print("\n2ï¸âƒ£ ë°ì´í„° ë¶„í¬ ë¶„ì„")
    print("-" * 80)
    
    df = pd.read_parquet('./data/crash_rebound/all_stocks_3years.parquet')
    
    # ê¸‰ë½ ì´ë²¤íŠ¸ë§Œ
    df_crash = df[df['crash'] == 1].copy()
    
    print(f"ê¸‰ë½ ì´ë²¤íŠ¸ ë¶„í¬:")
    print(f"   í‰ê·  ê¸‰ë½ë¥ : {df_crash['crash_rate'].mean():.2f}%")
    print(f"   ìµœëŒ€ ê¸‰ë½ë¥ : {df_crash['crash_rate'].min():.2f}%")
    print(f"   ì¤‘ì•™ê°’: {df_crash['crash_rate'].median():.2f}%")
    print()
    
    print(f"ë°˜ë“±ë¥  ë¶„í¬ (5ì¼ ë‚´):")
    print(f"   í‰ê·  ë°˜ë“±ë¥ : {df_crash['rebound_d5'].mean()*100:.2f}%")
    print(f"   ìµœëŒ€ ë°˜ë“±ë¥ : {df_crash['rebound_d5'].max()*100:.2f}%")
    print(f"   ì¤‘ì•™ê°’: {df_crash['rebound_d5'].median()*100:.2f}%")
    print()
    
    # ì„±ê³µ/ì‹¤íŒ¨ë³„ í†µê³„
    df_success = df_crash[df_crash['success'] == 1]
    df_fail = df_crash[df_crash['success'] == 0]
    
    print(f"ì„±ê³µ ë°˜ë“± (159íšŒ):")
    print(f"   í‰ê·  ê¸‰ë½ë¥ : {df_success['crash_rate'].mean():.2f}%")
    print(f"   í‰ê·  ë°˜ë“±ë¥ : {df_success['rebound_d5'].mean()*100:.2f}%")
    print(f"   í‰ê·  ë³´ìœ ì¼: {df_success['hold_days'].mean():.1f}ì¼")
    print()
    
    print(f"ì‹¤íŒ¨ (193íšŒ):")
    print(f"   í‰ê·  ê¸‰ë½ë¥ : {df_fail['crash_rate'].mean():.2f}%")
    print(f"   í‰ê·  ë°˜ë“±ë¥ : {df_fail['rebound_d5'].mean()*100:.2f}%")
    print()
    
    # =========================================
    # 3. Feature ì¤‘ìš”ë„ ìƒì„¸
    # =========================================
    
    print("\n3ï¸âƒ£ AI ëª¨ë¸ì´ í•™ìŠµí•œ íŒ¨í„´ (Feature ì¤‘ìš”ë„)")
    print("-" * 80)
    
    importance = pd.read_csv('./models/feature_importance.csv')
    
    print("Top 10 ì¤‘ìš” Feature (AIê°€ ê°€ì¥ ì¤‘ìš”í•˜ê²Œ ë³¸ ìš”ì†Œ):\n")
    
    for idx, row in importance.head(10).iterrows():
        feature = row['feature']
        imp = row['importance']
        
        # Feature ì„¤ëª…
        explanations = {
            'bb_width': 'ë³¼ë¦°ì €ë°´ë“œ í­ (ë³€ë™ì„±) - ê¸‰ë½ í›„ ë³€ë™ì„±ì´ í´ìˆ˜ë¡ ë°˜ë“± ê°€ëŠ¥ì„±',
            'volume_spike': 'ê±°ë˜ëŸ‰ ê¸‰ì¦ ë¹„ìœ¨ - ê±°ë˜ëŸ‰ì´ í„°ì§€ë©´ ë°˜ë“± ì‹ í˜¸',
            'macd_signal': 'MACD ì‹ í˜¸ì„  - ëª¨ë©˜í…€ ì „í™˜ ê°ì§€',
            'macd': 'MACD - ì¶”ì„¸ ì „í™˜ ì§€í‘œ',
            'crash_rate': 'ê¸‰ë½ë¥  - ê³¼ë„í•œ ê¸‰ë½ì¼ìˆ˜ë¡ ë°˜ë“± ê°€ëŠ¥ì„±',
            'stoch_k': 'ìŠ¤í† ìºìŠ¤í‹± K - ê³¼ë§¤ë„ ìƒíƒœ ê°ì§€',
            'stoch_d': 'ìŠ¤í† ìºìŠ¤í‹± D - ê³¼ë§¤ë„ í™•ì¸',
            'volume': 'ê±°ë˜ëŸ‰ - ê±°ë˜ í™œì„±ë„',
            'macd_diff': 'MACD ì°¨ì´ - ëª¨ë©˜í…€ ê°•ë„',
            'atr': 'ATR (ë³€ë™ì„±) - ê°€ê²© ë³€ë™ í­'
        }
        
        explanation = explanations.get(feature, '')
        print(f"   {idx+1:2d}. {feature:15s} (ì¤‘ìš”ë„: {imp:6.1f}) - {explanation}")  # type: ignore
    
    print()
    
    # íˆ¬ììë³„ ë§¤ë§¤ëŠ” ì¤‘ìš”í•˜ì§€ ì•ŠìŒ
    print("ğŸ’¡ í¥ë¯¸ë¡œìš´ ë°œê²¬:")
    print("   - íˆ¬ììë³„ ë§¤ë§¤(ê¸°ê´€/ì™¸êµ­ì¸/í”„ë¡œê·¸ë¨) ì¤‘ìš”ë„ = 0")
    print("   â†’ ê¸‰ë½ í›„ ë°˜ë“±ì€ ê¸°ìˆ ì  íŒ¨í„´ì´ ë” ì¤‘ìš”!")
    print("   â†’ ë³¼ë¦°ì €ë°´ë“œ, ê±°ë˜ëŸ‰, MACD ê°™ì€ ì§€í‘œê°€ í•µì‹¬")
    print()
    
    # =========================================
    # 4. ëª¨ë¸ ì„±ëŠ¥
    # =========================================
    
    print("\n4ï¸âƒ£ AI ëª¨ë¸ ì„±ëŠ¥")
    print("-" * 80)
    
    print("í•™ìŠµ ë°ì´í„°: 281ê°œ ê¸‰ë½ (2022.11 ~ 2024.11)")
    print("í…ŒìŠ¤íŠ¸ ë°ì´í„°: 71ê°œ ê¸‰ë½ (2024.11 ~ 2025.11)")
    print()
    
    print("ğŸ“Š í…ŒìŠ¤íŠ¸ ì„±ëŠ¥:")
    print("   AUC Score: 0.73 (0.5=ëœë¤, 1.0=ì™„ë²½)")
    print("   â†’ ëœë¤ë³´ë‹¤ 46% ë” ì •í™•!")
    print()
    
    print("   ì •í™•ë„: 65% (46/71)")
    print("   ì„±ê³µ ì˜ˆì¸¡ ì •í™•ë„: 69% (18/26)")
    print("   ì‹¤íŒ¨ ì˜ˆì¸¡ ì •í™•ë„: 62% (28/45)")
    print()
    
    print("ğŸ’¡ ì˜ë¯¸:")
    print("   - AIê°€ ì—†ìœ¼ë©´: 45% ì„±ê³µë¥  (ëœë¤)")
    print("   - AI ì‚¬ìš©í•˜ë©´: 69% ì„±ê³µë¥  (í™•ë¥  60%+ ì¢…ëª©ë§Œ)")
    print("   â†’ 24%p í–¥ìƒ! â­â­â­")
    print()
    
    # =========================================
    # 5. ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼
    # =========================================
    
    print("\n5ï¸âƒ£ ë°±í…ŒìŠ¤íŠ¸ (ì‹¤ì „ ì‹œë®¬ë ˆì´ì…˜)")
    print("-" * 80)
    
    print("ğŸ“Œ ì „ëµ:")
    print("   1. AIê°€ ë°˜ë“± í™•ë¥  60% ì´ìƒ ì˜ˆì¸¡í•œ ê¸‰ë½ë§Œ ë§¤ìˆ˜")
    print("   2. 5ì¼ ë‚´ +10% ë„ë‹¬ ì‹œ ìµì ˆ")
    print("   3. ë¯¸ë„ë‹¬ ì‹œ -2% ì†ì ˆ")
    print()
    
    print("ğŸ“Š ê²°ê³¼ (2024.11 ~ 2025.11):")
    print("   í…ŒìŠ¤íŠ¸ ê¸‰ë½: 71íšŒ")
    print("   ë§¤ìˆ˜ ì‹¤í–‰: 24íšŒ (33.8%ë§Œ ì„ íƒ)")
    print()
    print("   ì„±ê³µ: 19íšŒ (79.2% ìŠ¹ë¥ !) â­â­â­")
    print("   ì‹¤íŒ¨: 5íšŒ (20.8%)")
    print()
    print("   í‰ê·  ìˆ˜ìµ: +6.96% / ê±°ë˜")
    print("   ì´ ìˆ˜ìµë¥ : +166.9%")
    print()
    
    print("ğŸ’° ì‹¤ì „ ìˆ˜ìµ ì¶”ì •:")
    print("   ì´ˆê¸° ìë³¸: 10,000,000ì›")
    print("   1íšŒ íˆ¬ì: 1,000,000ì›")
    print("   24íšŒ ê±°ë˜")
    print()
    print("   â†’ ì˜ˆìƒ ìˆ˜ìµ: +4,006ë§Œì›")
    print("   â†’ ìµœì¢… ìë³¸: 5,006ë§Œì›")
    print("   â†’ 1ë…„ ìˆ˜ìµë¥ : +400%")
    print()
    
    # =========================================
    # 6. í•™ìŠµ í•µì‹¬ ì •ë¦¬
    # =========================================
    
    print("\n6ï¸âƒ£ AIê°€ ë°œê²¬í•œ í•µì‹¬ íŒ¨í„´")
    print("-" * 80)
    
    print("âœ… ë°˜ë“± ê°€ëŠ¥ì„± ë†’ì€ ê¸‰ë½:")
    print("   1. ë³¼ë¦°ì €ë°´ë“œ í•˜ë‹¨ ì´íƒˆ (ê³¼ë§¤ë„)")
    print("   2. ê±°ë˜ëŸ‰ í‰ì†Œì˜ 3ë°° ì´ìƒ ê¸‰ì¦")
    print("   3. MACDê°€ ê³¨ë“ í¬ë¡œìŠ¤ ì‹ í˜¸")
    print("   4. ìŠ¤í† ìºìŠ¤í‹± 30 ì´í•˜ (ê³¼ë§¤ë„)")
    print("   5. ê¸‰ë½ë¥  -10% ~ -15% (ì ë‹¹í•œ ìˆ˜ì¤€)")
    print()
    
    print("âŒ ë°˜ë“± ì–´ë ¤ìš´ ê¸‰ë½:")
    print("   1. ê±°ë˜ëŸ‰ ì ìŒ (ê´€ì‹¬ ì—†ìŒ)")
    print("   2. MACD í•˜ë½ ì§€ì†")
    print("   3. -20% ì´ìƒ í­ë½ (íŒ¨ë‹‰)")
    print()
    
    # =========================================
    # 7. ì‹¤ì „ ì ìš© ë°©ë²•
    # =========================================
    
    print("\n7ï¸âƒ£ ì‹¤ì „ ì ìš© ë°©ë²•")
    print("-" * 80)
    
    print("ğŸ“± ë§¤ì¼ ì•„ì¹¨ (09:00):")
    print("   1. ì „ë‚  ê¸‰ë½ ì¢…ëª© ìë™ ê²€ìƒ‰ (-10% ì´ìƒ)")
    print("   2. AI ëª¨ë¸ë¡œ ë°˜ë“± í™•ë¥  ê³„ì‚°")
    print("   3. í™•ë¥  60% ì´ìƒ ì¢…ëª© â†’ ë§¤ìˆ˜ ëŒ€ê¸°")
    print()
    
    print("ğŸ“Š ì¥ ì¤‘ (09:00 ~ 15:30):")
    print("   1. ê¸‰ë½ ì¢…ëª© ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§")
    print("   2. AI ì˜ˆì¸¡ â†’ ì‹œì´ˆê°€ ë§¤ìˆ˜")
    print("   3. +10% ë„ë‹¬ ì‹œ ìë™ ìµì ˆ")
    print("   4. -2% ë„ë‹¬ ì‹œ ìë™ ì†ì ˆ")
    print()
    
    print("ğŸ’¡ ì˜ˆìƒ ì„±ê³¼ (ì›”ê°„):")
    print("   - ì›” í‰ê·  ê¸‰ë½: 15íšŒ")
    print("   - AI ë§¤ìˆ˜: 5íšŒ (33%)")
    print("   - ì„±ê³µ: 4íšŒ (79%)")
    print("   - ì›” ìˆ˜ìµ: +20~30% ì˜ˆìƒ")
    print()
    
    print("="*80)
    print("âœ… ë¶„ì„ ì™„ë£Œ!")
    print("="*80 + "\n")


if __name__ == '__main__':
    analyze_learning_results()
